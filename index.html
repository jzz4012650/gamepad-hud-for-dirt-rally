<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gamepad</title>
    <style>
        html {
            color: #fff;
            background-color: #000;
            text-align: center;
        }

        main {
            display: flex;
            align-items: center;
            position: absolute;
            left: 50%;
            top: 0;
            transform: translate(-50%, 0);
        }

        canvas {
            border: 1px solid gray;
        }

        #handbreak, #wheel {
            width: 100px;
            height: 100px;
        }
        #handbreak{
            fill: gray;
        }
        #wheel {
            fill: white;
        }
    </style>
</head>

<body>
    <main>
        <canvas id="breaker" width="20" height="100"></canvas>
        <svg id="wheel" style="vertical-align: middle; overflow: hidden;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="14194"><path d="M437.6 861.7c-3.5-35-7.6-83.5-14.2-124.9-18-114.1-54.4-163.6-156.2-183-28.6-5.4-58.5-5.6-88.5-4.9-14.8-0.5-23.3 5.6-18.5 25.5 13.3 73.3 48.6 138.9 98.8 189.5 48 48.4 109.6 83.1 178.6 97.8m148.3 0c68.9-14.7 130.5-49.4 178.5-97.8 50.1-50.6 85.4-116.2 98.8-189.5 4.8-19.9-3.7-26-18.5-25.5-30-0.6-59.9-0.5-88.5 4.9-101.8 19.4-138.1 68.9-156.2 183-6.4 41.4-10.6 89.9-14.1 124.9m-53.4-308c15.6-7.7 26.4-24 26.4-42.7 0-19.9-12.1-36.9-29.2-44-11.4-4.7-24.4-4.7-35.8 0-17.2 7.1-29.2 24.1-29.2 44 0 18.7 10.7 35 26.4 42.7 12.9 6.4 28.5 6.4 41.4 0m60-124.1c-41.7-42.1-119.9-42.1-161.5 0-20.7 20.9-33.4 49.7-33.4 81.5 0 31.8 12.8 60.7 33.4 81.5 8 8 17.1 14.9 27.1 20.3 33.3 17.9 74 17.9 107.3 0 10-5.4 19.1-12.2 27.1-20.3 20.7-20.9 33.5-49.7 33.5-81.5 0-31.8-12.8-60.6-33.5-81.5M511.8 155c-93.8 0-187.5 32.9-252.7 98.7-38.8 39.2-68.7 87.3-86.5 141.1-4.9 18.1 1.6 26.6 19.6 25.6 58.8-2.3 185.6-4.1 211.6-5.4-22.4 25.6-35.9 59.2-35.9 96 0 40.1 16.1 76.4 42.2 102.7 9.3 9.4 19.9 17.5 31.4 24 21.8 12.3 46.1 18.5 70.4 18.5 24.3 0 48.6-6.2 70.4-18.5 11.5-6.5 22.1-14.6 31.4-24 26-26.3 42.2-62.6 42.2-102.7 0-36.8-13.6-70.4-35.9-96 26 1.3 152.8 3.1 211.6 5.4 17.9 1 24.5-7.5 19.6-25.6-17.7-53.8-47.6-101.9-86.5-141.1-65.4-65.8-159.2-98.7-252.9-98.7M346.4 927.7c-57.1-22.9-108.4-57.3-151.1-100.4-81-81.7-131.1-194.7-131.1-319.4 0-124.7 50.1-237.6 131.1-319.4C276.9 106.2 394.3 65 511.8 65c117.4 0 234.8 41.2 316.5 123.6 81 81.7 131.1 194.6 131.1 319.4 0 124.7-50.1 237.6-131.1 319.4-42.7 43.1-94 77.5-151.1 100.4-52.8 21.2-109.1 31.8-165.4 31.8-56.3 0-112.6-10.7-165.4-31.9" p-id="14195"></path><rect x="462" y="60" width="100" height="100" fill="red"></rect></svg>
        <canvas id="throttle" width="20" height="100"></canvas>
        <svg id="handbreak" style="vertical-align: middle; overflow: hidden;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="4407"><path d="M507.892961 829.211619c-181.171246 2.772136-329.371566-152.891156-322.282101-335.833745 6.404873-165.262928 138.400117-312.252677 324.266291-312.019363 190.374862 0.239454 326.003865 151.144372 324.725756 325.277318C833.25726 690.288592 687.378821 832.464709 507.892961 829.211619zM511.850086 263.927041c-135.037533-0.360204-244.448408 107.517759-244.785076 241.371326-0.324388 130.433678 109.006669 240.947677 236.549507 243.199974 134.398989 2.375094 248.89365-105.114013 248.692059-241.940284C752.104985 371.32098 645.151068 264.288269 511.850086 263.927041z" p-id="4408"></path><path d="M948.934862 512.193405c0.00307 108.080577-41.459251 208.014614-121.030517 292.316625-8.029884 8.506744-18.185174 16.645099-28.956495 20.571525-19.326161 7.046486-37.153178-1.108241-47.326888-17.372669-11.169387-17.85567-8.29492-36.647665 4.927219-54.712089 26.120914-35.685757 57.441247-69.585845 74.670653-109.387339 56.850799-131.327024 37.755905-254.685563-52.619428-366.191146-25.673729-31.66928-28.733415-56.317657-7.740288-75.15877 20.871353-18.735713 49.358151-12.32777 75.195609 18.754133C914.126079 302.894542 949.89063 396.819724 948.934862 512.193405z" p-id="4409"></path><path d="M70.868559 500.513388c1.537006-112.547309 39.417755-210.956619 115.161856-294.495244 19.043728-20.998243 44.87607-23.224957 64.214511-6.374174 19.141966 16.688077 21.245883 40.449247 2.422166 62.171991-45.427632 52.386114-77.601402 110.703311-89.104387 179.928952-18.611893 111.970164 12.632715 208.80563 86.599334 293.220205 5.458315 6.230911 11.67183 11.884678 16.510022 18.550495 14.353916 19.753903 12.268418 44.702108-4.40431 59.432601-16.775059 14.817474-42.085514 14.677281-59.610656-1.995447-49.550533-47.1386-86.830601-103.010095-106.464777-168.380942-13.771655-45.871747-20.865213-93.756337-30.947849-140.747581C67.124282 501.390361 68.995909 500.949316 70.868559 500.513388z" p-id="4410"></path><path d="M556.305577 442.533882c0 31.674397 0.178055 63.349817-0.053212 95.025237-0.230244 30.233582-19.183921 51.844785-45.0091 51.890834-27.297716 0.054235-44.789089-19.337417-44.917002-50.757011-0.24764-63.343677-0.355087-126.692471-0.071631-190.041264 0.148379-33.155121 18.080797-53.691853 44.952818-52.874231 27.486004 0.832971 44.936445 21.597901 45.077661 54.000891C556.42428 380.694465 556.316833 411.612639 556.305577 442.533882z" p-id="4411"></path><path d="M561.816081 666.801668c-0.475837 28.953426-23.287379 51.510164-51.843762 51.265594-28.555359-0.242524-52.495608-25.385157-51.580772-54.168714 0.832971-26.281573 25.223474-50.439786 51.078329-50.592258C538.699594 613.132328 562.303174 637.254725 561.816081 666.801668z" p-id="4412"></path></svg>
    </main>
    <script>
        const MAX_DEG = 540 / 2;
        const DEAD_ZONE = 5;

        window.addEventListener("gamepadconnected", function (e) {
            var gamepad = navigator.getGamepads()[e.gamepad.index];
            var throttle = document.getElementById("throttle");
            var breaker = document.getElementById("breaker");
            var wheel = document.getElementById("wheel");
            var handbreak = document.getElementById("handbreak");
            var ctxThrottle = throttle.getContext("2d");
            var ctxBreaker = breaker.getContext("2d");
            // var ctxHandbreak = handbreak.getContext("2d");
            var throttleWidth = throttle.width;
            var throttleHeight = throttle.height;
            var breakerWidth = breaker.width;
            var breakerHeight = breaker.height;

            function update() {
                gamepad = navigator.getGamepads()[e.gamepad.index];
                var throttleValue = gamepad.buttons[7].value;
                var breakValue = gamepad.buttons[6].value;
                var steeringValue = gamepad.axes[0];
                var handbreakValue = gamepad.buttons[1].value;

                // 清空画布

                // 绘制刹车
                var breakerRectH = breakerHeight * Math.abs(breakValue);
                ctxBreaker.clearRect(0, 0, throttleWidth, throttleHeight);
                ctxBreaker.fillStyle = "red";
                ctxBreaker.fillRect(0, breakerHeight - breakerRectH, breakerWidth, breakerRectH);

                // 绘制油门
                var throttleRectH = throttleHeight * Math.abs(throttleValue);
                ctxThrottle.clearRect(0, 0, throttleWidth, throttleHeight);
                ctxThrottle.fillStyle = "green";
                ctxThrottle.fillRect(0, throttleHeight - throttleRectH, throttleWidth, throttleRectH);

                // 绘制转向的进度条
                var steeringDeg = steeringValue * MAX_DEG;
                wheel.style.transform = `rotate(${Math.abs(steeringDeg) < DEAD_ZONE ? 0 : steeringDeg}deg)`;

                // 绘制手刹
                handbreak.style.fill = handbreakValue ? 'red' : 'gray';

                requestAnimationFrame(update);
            }

            update();

            function draw(context, width, height, value, fillColor) {
                ctx.clearRect(0, 0, width, height);
                ctx.fillStyle = "#000";
                ctx.fillRect(0, 0, width, height);
                ctx.fillStyle = fillColor;
                ctx.fillRect(0, 0, width * Math.abs(leftTriggerValue), height / 2);

            }
        });
    </script>
</body>

</html>